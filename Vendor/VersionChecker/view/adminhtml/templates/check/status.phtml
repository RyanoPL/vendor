<?php
$current = $block->getCurrentVersion();
$latest = $block->getLatestVersion();
$checkerCurrent = $block->getCheckerCurrentVersion();
$checkerLatest = $block->getCheckerLatestVersion();
?>
<div class="page-main-actions">
    <div class="page-actions">
        <div class="page-actions-inner">
            <h1 class="page-title">Global Payments Module Status</h1>
        </div>
    </div>
</div>

<div style="margin:10px 0;">
    <a href="https://github.com/globalpayments/magento2-2.0-plugin" target="_blank" rel="noopener">GlobalPayments repository</a>
    &nbsp;|&nbsp;
    <a href="https://github.com/RyanoPL/vendor" target="_blank" rel="noopener">Version Checker repository</a>
    &nbsp;|&nbsp;
    <span>Created by <a href="https://ryanotcg.pl" target="_blank" rel="noopener">RyanoPL</a></span>
    </div>

<?php if (!$block->isEnabled()): ?>
    <div class="message message-notice">
        <div>Notifications are disabled in configuration.</div>
    </div>
<?php else: ?>
    <div class="messages">
        <?php if ($latest && version_compare($current, $latest, '<')): ?>
            <div class="message message-warning">
                <div>Update detected. Latest: <strong><?= $latest ?></strong>, Installed: <?= $current ?></div>
            </div>
            <p>
                <a class="action-default scalable" style="background:#eb5202;color:#fff;padding:8px 15px;border-radius:3px;text-decoration:none" href="<?= $block->escapeUrl($block->getUpdateUrl($latest)) ?>">Install update</a>
            </p>
        <?php elseif ($latest): ?>
            <div class="message message-success">
                <div>The plugin is up to date. Version: <?= $current ?></div>
            </div>
        <?php else: ?>
            <div class="message message-error">
                <div>Failed to fetch the latest plugin version.</div>
            </div>
        <?php endif; ?>
        <hr/>
        <h2>Global Payments Module Status â€“ Version Checker module status</h2>
        <?php if ($checkerLatest && version_compare($checkerCurrent, $checkerLatest, '<')): ?>
            <div class="message message-warning">
                <div>A newer Version Checker module is available. Latest: <strong><?= $checkerLatest ?></strong>, Installed: <?= $checkerCurrent ?></div>
            </div>
            <p>
                <a class="action-default scalable" style="background:#eb5202;color:#fff;padding:8px 15px;border-radius:3px;text-decoration:none" href="<?= $block->escapeUrl($block->getCheckerUpdateUrl($checkerLatest)) ?>">Install Version Checker update</a>
            </p>
        <?php elseif ($checkerLatest): ?>
            <div class="message message-success">
                <div>The Version Checker module is up to date. Version: <?= $checkerCurrent ?></div>
            </div>
        <?php else: ?>
            <div class="message message-error">
                <div>Failed to fetch the latest Version Checker module version.</div>
            </div>
        <?php endif; ?>
    </div>
<?php endif; ?>
